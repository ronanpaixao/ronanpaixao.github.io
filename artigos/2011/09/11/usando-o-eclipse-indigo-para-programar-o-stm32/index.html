<!DOCTYPE html>
<html lang="pt_br" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Usando o Eclipse (Indigo) para programar o STM32 - Paixão por Eletrônica</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="../../../../../artigos/2011/09/11/usando-o-eclipse-indigo-para-programar-o-stm32/">

        <meta name="author" content="Ronan Paixão" />
        <meta name="keywords" content="microcontrolador,MCU,STM32,GCC,programação,Eclipse" />
        <meta name="description" content="Esses são os passos utilizados para fazer funcionar o Eclipse CDT para programar em microcontroladores ARM. Este tutorial foi testado com microcontroladores STM32F103, mas também deve funcionar para outros tipos, inclusive ARM7TDMI, bastando mudar alguns parâmetros. A idéia de usar o Eclipse puro, mesmo que dê mais trabalho que outras ..." />

        <meta property="og:site_name" content="Paixão por Eletrônica" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Usando o Eclipse (Indigo) para programar o STM32"/>
        <meta property="og:url" content="../../../../../artigos/2011/09/11/usando-o-eclipse-indigo-para-programar-o-stm32/"/>
        <meta property="og:description" content="Esses são os passos utilizados para fazer funcionar o Eclipse CDT para programar em microcontroladores ARM. Este tutorial foi testado com microcontroladores STM32F103, mas também deve funcionar para outros tipos, inclusive ARM7TDMI, bastando mudar alguns parâmetros. A idéia de usar o Eclipse puro, mesmo que dê mais trabalho que outras ..."/>
        <meta property="article:published_time" content="2011-09-11" />
            <meta property="article:section" content="artigos" />
            <meta property="article:tag" content="microcontrolador" />
            <meta property="article:tag" content="MCU" />
            <meta property="article:tag" content="STM32" />
            <meta property="article:tag" content="GCC" />
            <meta property="article:tag" content="programação" />
            <meta property="article:tag" content="Eclipse" />
            <meta property="article:author" content="Ronan Paixão" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="../../../../../theme/css/bootstrap.spacelab.min.css" type="text/css"/>
    <link href="../../../../../theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="../../../../../theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../../../theme/css/style.css" type="text/css"/>





</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="../../../../../" class="navbar-brand">
Paixão por Eletrônica            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                    <li><a href="http://ronan.dapaixao.com.br">Início</a></li>
                         <li><a href="../../../../../sobre-o-autor/">
                             Sobre o autor
                          </a></li>
                        <li class="active">
                            <a href="../../../../../categoria/artigos/">Artigos</a>
                        </li>
                        <li >
                            <a href="../../../../../categoria/projetos/">Projetos</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="../../../../../archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="../../../../../artigos/2011/09/11/usando-o-eclipse-indigo-para-programar-o-stm32/"
                       rel="bookmark"
                       title="Permalink to Usando o Eclipse (Indigo) para programar o STM32">
                        Usando o Eclipse (Indigo) para programar o STM32
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2011-09-11T18:08:00-03:00"> dom 11 setembro 2011</time>
    </span>





<span class="label label-default">Tags</span>
	<a href="../../../../../tag/microcontrolador/">microcontrolador</a>
        /
	<a href="../../../../../tag/mcu/">MCU</a>
        /
	<a href="../../../../../tag/stm32/">STM32</a>
        /
	<a href="../../../../../tag/gcc/">GCC</a>
        /
	<a href="../../../../../tag/programacao/">programação</a>
        /
	<a href="../../../../../tag/eclipse/">Eclipse</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>Esses são os passos utilizados para fazer funcionar o <a href="http://eclipse.org/">Eclipse</a> <a href="http://www.eclipse.org/cdt/">CDT</a> para programar em microcontroladores <a href="http://www.arm.com/">ARM</a>.
Este tutorial foi testado com microcontroladores <a href="http://www.st.com/web/en/catalog/mmc/SC1169/SS1031/LN1565">STM32F103</a>, mas também deve funcionar para outros tipos, inclusive ARM7TDMI, bastando mudar alguns parâmetros.</p>
<p>A idéia de usar o Eclipse puro, mesmo que dê mais trabalho que outras IDEs (mesmo as freeware), é que desta forma é possível customizá-lo inteiramente, com qualquer plugin disponível.
Pode-se inclusive misturar outras linguagens no mesmo projeto (como por exemplo adicionar geradores de código feitos em <a href="http://www.python.org">Python</a>).
Além disso, todos os recursos nativos da própria IDE podem ser habilitados (algumas IDEs, mesmo as baseadas no Eclipse, desativam vários recursos para deixar "mais fácil").</p>
<p>Ao desenvolver este tutorial, também foi possível entender como todas as partes de um projeto funcionam, inclusive as partes "escondidas" pelas IDEs comerciais.
Entendendo bem como tudo funciona, fica mais fácil corrigir qualquer problema que apareça e adicionar recursos, o que é praticamente impossível com IDEs fechadas.</p>
<p>Estas instruções incluem toda a configuração da IDE, de um toolchain livre e de uma interface <a href="https://en.wikipedia.org/wiki/Joint_Test_Action_Group">JTAG</a>.
Este tutorial foi feito no Windows 7 64-bits em Inglês.
Para sistemas de 32 bits e/ou em português, faça as modificações necessárias.</p>
<p>As versões dos aplicativos utilizados estão ao lado da menção de onde baixá-los, entre parênteses.</p>
<p>Caso queira baixar o template direto e começar logo a desenvolver, vá para a seção <a href="#Projeto C/C++ completo">Projeto C/C++ completo</a>.</p>
<h3>Começando com o Eclipse</h3>
<p><strong>Baixe o Eclipse</strong> (recomendado a versão para C/C++ developers) do site <a href="http://eclipsesource.com/en/downloads/">http://eclipsesource.com/en/downloads/</a> (3.7 Indigo).
Extraia o arquivo para onde você desejar que fique a instalação do Eclipse e, se achar conveniente, crie um atalho no menu iniciar.
Para isto, copie um atalho do eclipse.exe para <code>C:\Users\&lt;user&gt;\AppData\Roaming\Microsoft\Windows\Start Menu\Programs</code>, substituindo <code>&lt;user&gt;</code> pelo nome do seu usuário.</p>
<p><strong>Execute o Eclipse</strong>.
A primeira tela que aparece é a da configuração do workspace.
Selecione a pasta que você deseja colocar seus projetos.
Se desejar trabalhar com apenas um workspace, selecione a opção <strong>"Use this as the default and do not ask again"</strong>.
Clique em <strong>OK</strong>.
A tela seguinte, selecione a opção desejada para o UDC.
Se não quiser enviar nenhum dado de uso para a Eclipse Foundation, selecione <strong>"Turn UDC feature off"</strong>.
Clique em <strong>"Finish"</strong>.</p>
<p><img alt="" src="../../../../../artigos/Microcontroladores/eclipse/eclipse_01.png" style="max-width:100%;width:712px;margin-left:auto;margin-right:auto;height:auto"><div class="caption"></div></p>
<p>Vá no menu <strong>Help-&gt;Install New Software...</strong></p>
<p>No campo <strong>Work with</strong>, selecione <strong>"--All Available Sites--"</strong>.
Selecione os pacotes:</p>
<ul>
<li>Mobile and Device Development:<ul>
<li>C/C++ GCC Cross Compiler Support</li>
<li>C/C++ GDB Hardware Debugging
e clique em <strong>"Next"</strong> duas vezes.
Selecione <strong>"I accept the terms of the license agreements"</strong> e clique em <strong>Finish</strong>.
O Eclipse irá baixar e instalar os pacotes.
Ao final da instalação, reinicie o Eclipse clicando em <strong>Restart Now</strong> na janela que irá aparecer.</li>
</ul>
</li>
</ul>
<p><img alt="" src="../../../../../artigos/Microcontroladores/eclipse/eclipse_02.png" style="max-width:100%;width:797px;margin-left:auto;margin-right:auto;height:auto"><div class="caption"></div></p>
<p>Clique no botão <strong>"Workbench"</strong>, à direita da tela.</p>
<p><img alt="" src="../../../../../artigos/Microcontroladores/eclipse/eclipse_03.png" style="max-width:100%;width:1024px;margin-left:auto;margin-right:auto;height:auto"><div class="caption"></div></p>
<p><strong>Instale um toolchain</strong> para o processador desejado.
Eu testei com o <a href="http://www.yagarto.de/">YAGARTO</a> (23.12.2010) e o <a href="http://www.codesourcery.com/sgpp/lite/arm/portal/subscription?@template=lite">CodeSourcery G++ Lite for ARM EABI</a> (2010.09-51 e 2011.03-42).
O YAGARTO é um toolchain totalmente Open Source, enquanto o CodeSourcery é suportado por uma empresa de mesmo nome, que introduz melhorias no compilador.
Desses dois, o mais simples de se usar é o CodeSourcery, que por isto será usado neste tutorial.
Já o YAGARTO tem atualizações mais rápidas, sendo mais fácil de possuir o último GCC, porém é levemente mais difícil de instalar.</p>
<p>No site acima, baixe a versão <a href="https://en.wikipedia.org/wiki/Application_binary_interface#EABI">EABI</a>, que é a mais adequada para microcontroladores sem sistema operacional, os chamados <em>"bare metal"</em>.
Instale a partir do arquivo baixado, seguindo as instruções da tela.
Caso você já tenha alguma versão do CodeSourcery instalada (como, por exemplo, se você tiver o CoIDE instalado) não é necessário baixar e instalar novamente, a menos que se deseje uma versão mais atualizada.</p>
<p><strong>Baixe a biblioteca</strong> de periféricos padrão da ST para os microcontroladores STM32, em <a href="http://www.st.com/stonline/stappl/resourceSelector/app?page=resourceSelector&amp;doctype=FIRMWARE&amp;ClassID=1734">http://www.st.com/stonline/stappl/resourceSelector/app?page=resourceSelector&amp;doctype=FIRMWARE&amp;ClassID=1734</a> (baixei a versão 3.5.0).</p>
<p>Caso não ache ou o site não abra direito, vá em <a href="http://www.st.com">http://www.st.com</a> e procure na caixa "search" por seu dispositivo específico.
Neste caso achei a página <a href="http://www.st.com/internet/mcu/product/164487.jsp">http://www.st.com/internet/mcu/product/164487.jsp</a> e baixei a biblioteca de lá.</p>
<p><strong>Extraia</strong> para um local conhecido, por exemplo, <code>workspace\STM32F10x_StdPeriph_Lib</code>.
Este diretório será usado mais à frente nas configurações do projeto.
Um bom local para ele ficar é no mesmo workspace do projeto, pois assim a pasta pode ser acessada através de links relativos, como por exemplo <code>..\..\STM32F10x_StdPeriph_Lib</code>.</p>
<h3>Configurando o Adaptador JTAG</h3>
<p>Esta operação pode ser feita caso o usuário tenha um adaptador JTAG compatível com a plataforma ARM.</p>
<p>O <a href="http://openocd.org/">OpenOCD</a> é uma das ferramentas disponíveis para debugging através de um dispositivo JTAG, porém há outros servidores disponíveis que podem ser utilizados de forma mais fácil.
No entanto (ainda) não achei nenhum com a mesma flexibilidade do OpenOCD.
Além disto, é possível compilar o OpenOCD para usar diretamente os <a href="http://www.ftdichip.com/Drivers/D2XX.htm">drivers D2XX da FTDI</a>.
Isso, porém, requer uma compilação devido à licença das bibliotecas binárias da FTDI não permitirem sua redistribuição.</p>
<p>Para começar, devemos <strong>conectar o dispositivo JTAG</strong>.
Este deve ser compatível com o OpenOCD, ou este método não funcionará.
No meu caso, eu conectei um GuruPlug JTAG Board, que na verdade é o mesmo hardware do dispositivo JTAG embutido no Sheevaplug.
Ele é baseado no FT2232, um chip USB-&gt;Serial/FIFO.</p>
<p>Há diversos dispositivos JTAG baseados neste chip, incluindo:</p>
<ul>
<li>Sheevaplug JTAG</li>
<li>CoLink (não suportado pelo OpenOCD 0.4.0 sem patches)</li>
<li>Bus Blaster</li>
<li>Olimex ARM-USB-OCD</li>
<li>Amontec JTAGkey (1 e 2)</li>
</ul>
<p>Abra o Device Manager (Gerenciador de Dispositivos).
Caso seja desejado, instale o <a href="http://www.ftdichip.com/Drivers/VCP.htm">driver VCP da FTDI</a> (Virtual COM Port) para o conversor serial B.
Isto instalará a interface B do FT2232, que serve como um conversor USB-serial.</p>
<p><strong>Baixe o libusb</strong> (1.2.4.0) binário, do site <a href="http://www.libusb.org/wiki/libusb-win32">http://www.libusb.org/wiki/libusb-win32</a> (link direto para download: <a href="http://sourceforge.net/projects/libusb-win32/files/libusb-win32-releases/">http://sourceforge.net/projects/libusb-win32/files/libusb-win32-releases/</a>).</p>
<p><strong>Extraia</strong> para alguma pasta, vá no subdiretório <code>bin</code> e execute o arquivo <strong><code>inf-wizard.exe</code></strong>.
Na janela que abrir, clique <strong>"Next"</strong>.</p>
<p>Na próxima janela, <strong>selecione o dispositivo</strong> adequado.</p>
<p><img alt="" src="../../../../../artigos/Microcontroladores/eclipse/inf-wizard_01.png" style="max-width:100%;width:561px;margin-left:auto;margin-right:auto;height:auto"><div class="caption"></div></p>
<p>No meu caso, foi o SheevaPlug JTAGKey FT2232D B (Interface 0).
Foi selecionado a Interface 0 pois esta é a interface FIFO do FT2232 e normalmente é a usada para o JTAG. A Interface 1 costuma ser a saída serial (UART).</p>
<p>Clique em <strong>"Next"</strong> nas duas próximas janelas.
Irá abrir uma janela para salvar um arquivo <code>.inf</code>.
Este é o arquivo que vai associar o driver ao dispositivo.
Ele pode ser apagado depois da instalação.</p>
<p>Na próxima janela, clique em <strong>"Install Now"</strong>.
O controle de acesso do Windows irá pedir autorização.
Autorize clicando em <strong>"Yes"</strong>.
Após isso, o Windows reclamará que o driver não é assinado.
Clique em <strong>"Install this driver software anyway"</strong> ("Instalar este software de driver mesmo assim").</p>
<p><img alt="" src="../../../../../artigos/Microcontroladores/eclipse/inf-wizard_02.png" style="max-width:100%;width:561px;margin-left:auto;margin-right:auto;height:auto"><div class="caption"></div></p>
<p>Irá aparecer uma janela escrito "Installation successful".
Clique em <strong>OK</strong>.
O <em>inf-wizard</em> fechará.</p>
<p>Para confirmar que a instalação ocorreu sem problemas, vá no Device Manager.
No item da árvore "libusb-win32 devices" aparecerá o dispositivo configurado.</p>
<p><img alt="" src="../../../../../artigos/Microcontroladores/eclipse/device_manager_01.png" style="max-width:100%;width:364px;margin-left:auto;margin-right:auto;height:auto"><div class="caption"></div></p>
<p><strong>Baixe o OpenOCD</strong> (0.4.0) para Windows.
O site original do projeto OpenOCD é <a href="http://openocd.berlios.de/web/">http://openocd.berlios.de/web/</a>, porém este é feito originalmente para Linux.
Para encontrar uma versão para Windows, vá em <a href="http://www.freddiechopin.info/index.php/en/download/category/4-openocd">http://www.freddiechopin.info/index.php/en/download/category/4-openocd</a>.</p>
<p>Abra o arquivo e execute o instalador <code>openocd.msi</code>.
<strong>Instale</strong> o pacote seguindo as instruções.</p>
<p>Teste se a instalação ocorreu sem problemas.
Para isto, conecte o JTAG à placa com o alvo e abra a linha de comando (<code>cmd.exe</code>).
Digite:</p>
<div class="highlight"><pre><span></span>openocd -f interface/sheevaplug.cfg -f target/stm32.cfg
</pre></div>


<p>Esta é a linha para o meu dispositivo JTAG (sheevaplug) e o meu alvo (um microcontrolador ARM do tipo STM32).
Para saber quais já existem interfaces e alvos pré-configurados no OpenOCD, olhe na pasta de instalação do OpenOCD, no meu caso <code>C:\Program Files (x86)\OpenOCD\0.4.0</code>.
Ali há as subpastas <code>interface</code> e <code>target</code>, correspondentes aos adaptadores JTAG e os chips suportados.</p>
<p>O firewall do Windows pode pedir autorização para ele acessar a rede.
Permita o acesso, ou haverá problemas para acessar o servidor do OpenOCD.</p>
<p>A saída do comando acima deve ser algo como:</p>
<div class="highlight"><pre><span></span>Open On-Chip Debugger 0.4.0 (2010-02-22-19:05)
Licensed under GNU GPL v2
For bug reports, read
        http://openocd.berlios.de/doc/doxygen/bugs.html
2000 kHz
1000 kHz
jtag_nsrst_delay: 100
jtag_ntrst_delay: 100
Info : clock speed 1000 kHz
Info : JTAG tap: stm32.cpu tap/device found: 0x3ba00477 (mfg: 0x23b, part: 
0xba00, ver: 0x3)
Info : JTAG tap: stm32.bs tap/device found: 0x16410041 (mfg: 0x020, part: 
0x6410, ver: 0x1)
Info : stm32.cpu: hardware has 6 breakpoints, 4 watchpoints
</pre></div>


<h3>Configurando o Eclipse para usar o adaptador JTAG via OpenOCD</h3>
<p>No Eclipse, abra uma perspectiva C/C++, vá no menu <strong>Run-&gt;External Tools-&gt;External Tools Configurations...</strong></p>
<p>Na janela que aparece, vá no painel esquerdo, selecione <strong>"Program"</strong> e clique no ícone <strong>"New launch configuration"</strong>.</p>
<p><img alt="" src="../../../../../artigos/Microcontroladores/eclipse/eclipse_04.png" style="max-width:100%;width:241px;margin-left:auto;margin-right:auto;height:auto"><div class="caption"></div></p>
<p>No painel à direita, escolha um nome significativo e coloque no campo <strong>"Name"</strong>, por exemplo, "OpenOCD Server".</p>
<p>Em <strong>"location"</strong>, coloque o caminho para o executável do OpenOCD, por exemplo,</p>
<div class="highlight"><pre><span></span>C:\Program Files (x86)\OpenOCD\0.4.0\bin\openocd.exe
</pre></div>


<p>Em <strong>"Working Directory"</strong> coloque</p>
<div class="highlight"><pre><span></span>${workspace_loc}\${project_path}\Debug
</pre></div>


<p>Em <strong>"arguments"</strong>, coloque </p>
<div class="highlight"><pre><span></span>-f interface/sheevaplug.cfg -f target/stm32.cfg
</pre></div>


<p>ou as opções para seu adaptador e microcontrolador, conforme visto anteriormente.</p>
<p><img alt="" src="../../../../../artigos/Microcontroladores/eclipse/eclipse_05.png" style="max-width:100%;width:773px;margin-left:auto;margin-right:auto;height:auto"><div class="caption"></div></p>
<p>Cheque na aba <strong>"Build"</strong> se a opção <strong>"Build before launch"</strong> está desativada.</p>
<p><img alt="" src="../../../../../artigos/Microcontroladores/eclipse/eclipse_06.png" style="max-width:100%;width:268px;margin-left:auto;margin-right:auto;height:auto"><div class="caption"></div></p>
<p>Clique em <strong>"Apply"</strong> e <strong>"Close"</strong>.
Desta forma, o OpenOCD poderá ser executado diretamente através do ícone de <strong>"External Program"</strong>, que fica ao lado do ícone "Run".</p>
<p><img alt="" src="../../../../../artigos/Microcontroladores/eclipse/eclipse_07.png" style="max-width:100%;width:264px;margin-left:auto;margin-right:auto;height:auto"><div class="caption"></div></p>
<div class="admonition note">
<p class="admonition-title"><i class="fa fa-lightbulb-o"></i> Nota:</p>
<p>Como o diretório de trabalho usa a variável <code>${project_path}</code>, é necessário que o projeto ou um dos arquivos do projeto do qual se deseja fazer o debug esteja selecionado antes de clicar no ícone de Run.</p>
<p>Caso deseje associar a chamada externa ao OpenOCD ao projeto, substitua o <code>${project_path}</code> pelo diretório do projeto dentro do workspace.
Vá na aba <strong>Common</strong>, no campo <strong>Save as</strong> selecione <strong>Shared file</strong> e coloque o caminho para dentro do projeto.</p>
</div>
<p>Para debugar um programa, deve-se criar uma configuração de debug para cada projeto, o que será explicado mais abaixo.</p>
<h3>Flash Loader Demonstrator (opcional)</h3>
<p>O Flash Loader Demonstrator é um utilitário para se programar o STM32 a partir de seu bootloader serial (embutido no microcontrolador).
Para baixá-lo, vá na página do seu microcontrolador no site da ST e procure o link para <code>STM32F101xx and STM32F103xx Flash loader demonstrator: Contains the Demo GUI, Command line and header source files</code>.</p>
<p><strong>Baixe o arquivo</strong>, <strong>extraia</strong> e <strong>instale</strong> a partir do programa <code>Flash_Loader_Demonstrator_v2.2.0_Setup.exe</code>.
Siga as instruções na tela, com atenção ao local onde ele será instalado.</p>
<p>Para acionar o Flash Loader Demo direto a partir do Eclipse, vá em <strong>Run-&gt;External Tools-&gt;External Tools Configurations...</strong></p>
<p>Selecione <strong>"Program"</strong> e clique no ícone <strong>"New launch configuration"</strong>.</p>
<p>Dê um <strong>nome</strong> ao utilitário, por exemplo "Flash Loader".</p>
<p>Em <strong>"Location"</strong>, coloque o caminho para o utilitário da ST, por exemplo,</p>
<div class="highlight"><pre><span></span>C:\Program Files (x86)\STMicroelectronics\Software\Flash Loader Demonstrator\STMicroelectronics flash loader.exe
</pre></div>


<p>Se desejado, preencha em <strong>"Arguments"</strong> as opções para o utilitário, caso deseje executá-lo como se fosse a partir da linha de comando.</p>
<p>Para evitar que o programa compile toda vez que se executar esta ferramenta, vá na aba <strong>"Build"</strong> e desative a caixa <strong>"Build before launch"</strong>.</p>
<h3>Configurando um projeto no Eclipse 3.7 (Indigo)</h3>
<div class="admonition note">
<p class="admonition-title"><i class="fa fa-star"></i> Nota:</p>
<p>Este tutorial já está adaptado para utilizar o C++ no projeto.</p>
</div>
<p>Crie um novo projeto no menu <strong>File-&gt;New-&gt;C++ Project</strong>.
Se isto não funcionar, vá em <strong>File-&gt;New-&gt;Project</strong>.
Na janela que aparece, selecione <strong>C/C++-&gt;C++ Project</strong>.</p>
<p>Coloque um nome no projeto em <strong>"Project name"</strong>.
Em "<strong>Project type"</strong>, selecione <strong>Executable-&gt;Cross-Compile Project</strong>.
Em "<strong>Toolchain"</strong>, escolha <strong>"Cross GCC"</strong>.
Clique em <strong>"Next"</strong>.</p>
<p><img alt="" src="../../../../../artigos/Microcontroladores/eclipse/project_01.png" style="max-width:100%;width:700px;margin-left:auto;margin-right:auto;height:auto"><div class="caption"></div></p>
<p>Em <strong>"Command prefix"</strong>, coloque <strong><code>arm-none-eabi-</code></strong> (note o hífen ao final).
Em <strong>"Command path"</strong>, coloque o caminho para os executáveis do CodeSourcery, no meu caso foi <strong><code>C:\Program Files (x86)\CodeSourcery\Sourcery G++ Lite\bin</code></strong>.
Clique em <strong>"Next"</strong>.</p>
<p><img alt="" src="../../../../../artigos/Microcontroladores/eclipse/project_03.png" style="max-width:100%;width:700px;margin-left:auto;margin-right:auto;height:auto"><div class="caption"></div></p>
<p>Caso deseje, você pode desativar uma das configurações (Debug ou Release).
Clique em <strong>"Advanced settings..."</strong>.</p>
<p><img alt="" src="../../../../../artigos/Microcontroladores/eclipse/project_04.png" style="max-width:100%;width:700px;margin-left:auto;margin-right:auto;height:auto"><div class="caption"></div></p>
<p>No painel à esquerda, vá em <strong>C/C++ Build-&gt;Tool Chain Editor</strong>.
Na esquerda, clique no botão <strong>"Select Tools..."</strong>.</p>
<p><img alt="" src="../../../../../artigos/Microcontroladores/eclipse/project_05.png" style="max-width:100%;width:1041px;margin-left:auto;margin-right:auto;height:auto"><div class="caption"></div></p>
<p>Na janela que abre, Selecione no painel da esquerda o item <strong>"GCC Assembler"</strong> e clique no botão <strong>"Add tool --&gt;"</strong>.
O item passará para o painel da direita.
Clique em <strong>OK</strong>.</p>
<p><img alt="" src="../../../../../artigos/Microcontroladores/eclipse/project_06.png" style="max-width:100%;width:862px;margin-left:auto;margin-right:auto;height:auto"><div class="caption"></div></p>
<p>No topo da janela, mude a opção <strong>"Configuration:"</strong> para <strong>"Release"</strong> e repita este passo (se for o caso).</p>
<p>Mude a opção <strong>"Configuration:"</strong> para <strong>"[ All Configurations ]"</strong>, de forma que as configurações sejam válidas tanto para Debug quanto para Release.
No painel da esquerda, vá no item <strong>"C/C++ Build"</strong>.
No campo <strong>"Builder type"</strong> selecione a opção <strong>"Internal builder"</strong></p>
<p><img alt="" src="../../../../../artigos/Microcontroladores/eclipse/project_07.png" style="max-width:100%;width:1041px;margin-left:auto;margin-right:auto;height:auto"><div class="caption"></div></p>
<p>Caso deseje, vá na aba <strong>"Behaviour"</strong> e selecione a opção <strong>"Use parallel build"</strong> e <strong>"Use optimal jobs number"</strong>.
Esta opção divide o trabalho da compilação nos vários processadores do computador, caso haja mais de um.
Isso acelera o processo de compilação, porém pode trazer alguns tipos de problemas, tipo mensagens de erro fora de ordem (mas eu uso mesmo assim).</p>
<p>Vá no item <strong>C/C++ Build-&gt;Settings</strong>.
Na aba <strong>"Tool Settings"</strong>, item <strong>Cross GCC Compiler-&gt;Symbols</strong>, adicione na lista <strong>"Defined Symbols (-D)"</strong>, o item </p>
<div class="highlight"><pre><span></span>STM32F10X_MD
</pre></div>


<p>para Medium Devices, ou o referente à densidade do chip usado (<code>STM32F10X_HD</code> para High-density devices), de acordo com os <code>#defines</code> do arquivo</p>
<div class="highlight"><pre><span></span>workspace\STM32F10x_StdPeriph_Lib\Libraries\CMSIS\CM3\DeviceSupport\ST\STM32F10x\stm32f10x.h
</pre></div>


<p>Coloque a mesma opção em <strong>Cross G++ Compiler-&gt;Preprocessor</strong> na lista <strong>"Defined Symbols (-D)"</strong>.</p>
<p>Em ambos os compiladores, vá no subitem <strong>"Includes"</strong> e adicione no campo <strong>"Include paths (-I)"</strong> os seguintes itens:</p>
<div class="highlight"><pre><span></span>${workspace_loc:/${ProjName}/inc}
../../STM32F10x_StdPeriph_Lib/Libraries/STM32F10x_StdPeriph_Driver/inc/
../../STM32F10x_StdPeriph_Lib/Libraries/CMSIS/CM3/CoreSupport
../../STM32F10x_StdPeriph_Lib/Libraries/CMSIS/CM3/DeviceSupport/ST/STM32F10x
</pre></div>


<p>Note que alguns caminhos começam com <code>../../STM32F10x_StdPeriph_Lib</code>.
Este é o caminho relativo para a pasta com a biblioteca da ST, a partir do diretório de build.
Ajuste adequadamente, de acordo com a posição do projeto e da biblioteca, ou deixe com o caminho absoluto.
Deixei com o caminho relativo para simplificar caso o diretório do workspace mude de lugar.
O primeiro caminho aponta para o diretório <code>inc</code>, que será criado para armazenar os arquivos de headers.</p>
<p>Também inclua no campo <strong>"Include files (-include)"</strong> o arquivo</p>
<div class="highlight"><pre><span></span>"${workspace_loc:/${ProjName}/inc/stm32f10x_conf.h}"
</pre></div>


<p><img alt="" src="../../../../../artigos/Microcontroladores/eclipse/project_08.png" style="max-width:100%;width:1041px;margin-left:auto;margin-right:auto;height:auto"><div class="caption"></div></p>
<p>Se desejado, vá em todos os <strong>compilers-&gt;Optimization</strong> e ajuste as opções de otimização.
Por exemplo <strong>"Optimization level=Optimize for size (-Os)"</strong>, que reduz o tamanho do código gerado (em troca de performance, então pode ser melhor usar o <code>-O2</code>).
Também pode ser possível reduzir o tamanho do código ao se eliminar código morto (não utilizado) colocando-se no campo <strong>"Other optimization flags"</strong> as opções</p>
<div class="highlight"><pre><span></span>-ffunction-sections -fdata-sections
</pre></div>


<p>e indo no item em <strong>Cross G++ Linker-&gt;Miscellaneous</strong> e colocar no campo <strong>"Other options (-Xlinker [option])"</strong> a opção para remover as seções não utilizadas</p>
<div class="highlight"><pre><span></span>--gc-sections
</pre></div>


<p><img alt="" src="../../../../../artigos/Microcontroladores/eclipse/project_09.png" style="max-width:100%;width:1041px;margin-left:auto;margin-right:auto;height:auto"><div class="caption"></div></p>
<p>Voltando ao <strong>Cross GCC Compiler</strong>, vá no sub-item <strong>"Miscellaneous"</strong> e adicione no campo <strong>"Other flags"</strong> as opções </p>
<div class="highlight"><pre><span></span>-mthumb -mcpu=cortex-m3 -mfix-cortex-m3-ldrd
</pre></div>


<p>Opcionalmente, adicione também a opção <strong><code>-std=gnu99</code></strong> para suportar as extensões GNU99 da linguagem C.
Assim, a linha inteira fica da seguinte forma:</p>
<div class="highlight"><pre><span></span>-c -fmessage-length=0 -mthumb -mcpu=cortex-m3 -mfix-cortex-m3-ldrd -std=gnu99
</pre></div>


<p>Para C++, este parâmetro seria <strong><code>-std=gnu++0x</code></strong>, e para evitar código extra referente a exceções, podemos usar as opções <strong><code>-fno-exceptions -fno-rtti</code></strong>, como visto na <a href="../../../../../artigos/2011/09/06/usando-cpp-em-microcontroladores/">página sobre C++</a>.
Aproveite e copie desta página o arquivo <strong><code>mini_cpp.cpp</code></strong> para o projeto, por exemplo para a pasta <code>lib</code>. Caso você também precise utilizar o operador <strong><code>new</code></strong>, também copie o arquivo <strong><code>syscalls.c</code></strong>.
Fica a linha inteira assim:</p>
<div class="highlight"><pre><span></span>-c -fmessage-length=0 -mthumb -mcpu=cortex-m3 -mfix-cortex-m3-ldrd -std=c++0x -fno-exceptions -fno-rtti
</pre></div>


<p><img alt="" src="../../../../../artigos/Microcontroladores/eclipse/project_10.png" style="max-width:100%;width:1041px;margin-left:auto;margin-right:auto;height:auto"><div class="caption"></div></p>
<p>Caso queira incluir bibliotecas pré-compiladas, faça isso no sub-item <strong>"Libraries"</strong>.
Por exemplo, caso você tenha pré-compilado a biblioteca da ST, inclua (por exemplo) no campo <strong>"Libraries (-l)"</strong>, o item <strong><code>stdPeriphLibs</code></strong> e adicione ao campo <strong>"Library search path (-L)"</strong> o item </p>
<div class="highlight"><pre><span></span><span class="cp">../../STM32F10x_StdPeriph_Lib</span>
</pre></div>


<p>No sub-item <strong>"Miscellaneous"</strong>, coloque em <strong>"Linker flags"</strong>:</p>
<div class="highlight"><pre><span></span>-mthumb -mcpu=cortex-m3 -mfix-cortex-m3-ldrd -Wl,-Map=\<span class="cp">${</span><span class="n">ProjName</span><span class="cp">}</span>.map -Wl,-cref -T ..\..\STM32F10x_StdPeriph_Lib\Project\STM32F10x_StdPeriph_Template\TrueSTUDIO\STM3210B-EVAL\stm32_flash.ld
</pre></div>


<p><img alt="" src="../../../../../artigos/Microcontroladores/eclipse/project_11.png" style="max-width:100%;width:1041px;margin-left:auto;margin-right:auto;height:auto"><div class="caption"></div></p>
<p>O arquivo indicado após a opção <code>-T</code> é um linker script para o STM32F103RB.
Para utilizar outro chip, pode-se procurar em outros exemplos de projetos ou copiar o arquivo para a pasta do projeto, alterar as linhas de interesse e o caminho do script do linker nas preferências do projeto.
Por exemplo, para o STM32F103RE, pode-se trocar o caminho de <code>STM3210B-EVAL</code> para <code>STM3210E-EVAL</code>.
Uma rápida comparação entre os projetos para placas STM3210B-EVAL e STM3210E-EVAL mostra que as linhas mais importantes são a 36, 45 e 46, referentes aos tamanhos de FLASH e RAM.</p>
<p>Também podem ser usados outros <em>linker scripts</em> que podem ser baixados da internet, conforme a necessidade.
Outra opção é copiar este arquivo para a pasta do projeto, o deixaria o projeto auto-contido (com todos os arquivos necessários) e permitiria mudanças específicas para o projeto atual.</p>
<p>Vá agora no item <strong>"GCC Assembler"</strong> e mude o campo <strong>"Command"</strong> para <strong><code>arm-none-eabi-as</code></strong>.
No sub-item <strong>"General"</strong>, no campo <strong>"Assembler flags"</strong> coloque </p>
<div class="highlight"><pre><span></span>-mthumb -mcpu=cortex-m3
</pre></div>


<p>Agora vá na aba <strong>"Build Steps"</strong>, coloque no campo <strong>"Post-build steps-&gt;Command"</strong> a linha:</p>
<div class="highlight"><pre><span></span>../post_build.bat ${BuildArtifactFileName} ${ProjName}
</pre></div>


<p>No diretório do projeto, crie um arquivo chamado <strong><code>post_build.bat</code></strong> com o seguinte conteúdo:</p>
<h5><i class="fa fa-file-code-o"></i> post_build.bat</h5>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>arm-none-eabi-objdump -h -S <span class="nv">%1</span> <span class="p">&gt;</span> <span class="s2">"</span><span class="nv">%2</span><span class="s2">.lst"</span>
arm-none-eabi-objcopy -O ihex <span class="nv">%1</span> <span class="s2">"</span><span class="nv">%2</span><span class="s2">.hex"</span>
arm-none-eabi-objcopy -O binary <span class="nv">%1</span> <span class="s2">"main.bin"</span>
arm-none-eabi-size --format=berkeley <span class="s2">"</span><span class="nv">%2</span><span class="s2">.hex"</span> <span class="nv">%1</span>
</pre></div>
</td></tr></table>

<p>Vá na aba <strong>"Build Artifact"</strong> e coloque como <strong>"Artifact extension"</strong> o texto <strong><code>elf</code></strong>.
Isso é feito para facilitar a identificação dos arquivos construídos.</p>
<p>No painel da esquerda, vá em <strong>C/C++ Build-&gt;Discovery Options</strong>.
Para cada uma das configurações (Debug e Release), vá em <strong>"Discovery profiles scope"</strong>, selecione <strong>"Configuration-wide"</strong>.
Vá no campo <strong>"Discovery profile options-&gt;Compiler invocation command"</strong> e troque para <strong><code>arm-none-eabi-g++</code></strong>.
Logo abaixo, em <strong>"Compiler invocation arguments"</strong>, onde está <strong><code>specs.c</code></strong>, coloque <strong><code>specs.cpp</code></strong>.</p>
<p>Clique em <strong>OK</strong> e em seguida em <strong>Finish</strong>.
Isso terminará de criar o projeto (ainda sem nenhum arquivo).</p>
<p><em>Opcional:</em> Para fins de organização, crie pastas para separar os tipos de arquivos.
Neste caso, criei <strong><code>inc</code></strong>, <strong><code>src</code></strong> e <strong><code>lib</code></strong>, sendo que o <strong><code>src</code></strong> e o <strong><code>lib</code></strong> eu criei como <em>source folder</em>.</p>
<p>Vá na pasta</p>
<div class="highlight"><pre><span></span>STM32F10x_StdPeriph_Lib\Libraries\CMSIS\CM3\DeviceSupport\ST\STM32F10x\startup\TrueSTUDIO
</pre></div>


<p>e copie o arquivo correspondente ao seu dispositivo, por exemplo <strong><code>startup_stm32f10x_md.s</code></strong> para a pasta <strong><code>lib</code></strong> do projeto.
Renomeie este arquivo para ter uma extensão <strong><code>.S</code></strong> (maiúsculo) ou <strong><code>.asm</code></strong> (o builder do Eclipse não reconhece a extensão <code>.s</code> como um arquivo a ser compilado).</p>
<p>Copie os arquivos <strong><code>.h</code></strong> e <strong><code>.c</code></strong> da pasta</p>
<div class="highlight"><pre><span></span>STM32F10x_StdPeriph_Lib\Project\STM32F10x_StdPeriph_Template
</pre></div>


<p>para a pasta do projeto.
Separe respectivamente nos diretórios <strong><code>inc</code></strong> e <strong><code>src</code></strong>, exceto o <strong><code>system_stm32f10x.c</code></strong>, que pode ser colocado na pasta <strong><code>lib</code></strong>.
Isto é feito somente para fins de organizacão, mas pode ficar em qualquer pasta que seja source folder.
Não é necessário copiar os arquivos das sub-pastas, a menos que se deseje copiar um dos linker scripts existentes nessas pastas.</p>
<p>Caso deseje que o microcontrolador opere a uma velocidade diferente de 72MHz, abra o arquivo <strong><code>system_stm32f10x.c</code></strong>, comente a linha</p>
<div class="highlight"><pre><span></span>#define SYSCLK_FREQ_72MHz  72000000
</pre></div>


<p>e descomente a linha da velocidade desejada.</p>
<p>Em algumas placas pode haver um bug que pode fazer com que o microcontrolador fique com a velocidade diferente do previsto, caso o cristal não se estabilize a tempo.
Para corrigí-lo, dentro da função <code>SetSysClockTo72(void)</code> (ou equivalente para outras velocidades) mude as referências <strong><code>HSE_STARTUP_TIMEOUT</code></strong> para <strong><code>HSE_STARTUP_TIMEOUT*2</code></strong>:</p>
<div class="highlight"><pre><span></span>} while((HSEStatus == 0) &amp;&amp; (StartUpCounter != HSE_STARTUP_TIMEOUT*2));
</pre></div>


<p>Isso dará mais tempo para o cristal estabilizar.</p>
<p>No arquivo <strong><code>stm32f10x_conf.h</code></strong>, comente os periféricos que não serão usados no projeto e descomente os que serão usados.</p>
<p>Caso seja necessário e não haja uma biblioteca pré-compilada para isto, copie os arquivos <code>.c</code> usados da biblioteca da ST para a pasta <code>lib</code>.
Alternativamente estes arquivos podem ser só incluídos virtualmente, clicando e arrastando diretamente para a árvore de arquivos do Eclipse e selecionando <strong>"Link to files"</strong>.
Estes arquivos estão na pasta</p>
<div class="highlight"><pre><span></span>STM32F10x_StdPeriph_Lib\Libraries\STM32F10x_StdPeriph_Driver\src
</pre></div>


<p>Para teste do sistema, pode ser usado o arquivo <code>main.cpp</code> do exemplo em <a href="#anexos">anexo</a>, que é uma forma de blinky (pisca-pisca de LED) bem simplificado.</p>
<p>A árvore de pastas ficará desta forma:</p>
<p><img alt="" src="../../../../../artigos/Microcontroladores/eclipse/project_12.png" style="max-width:100%;width:262px;margin-left:auto;margin-right:auto;height:auto"><div class="caption"></div></p>
<p>Esta pasta serve como um bom modelo para ser copiado a cada projeto novo, para evitar a necessidade de reconfigurar o projeto toda hora.
Uma pasta completa pode ser encontrada nos <a href="#anexos">anexos</a>.
Também é possivel criar um template da forma descrita em <a href="http://help.eclipse.org/helios/index.jsp?topic=/org.eclipse.cdt.doc.isv/guide/projectTemplateEngine/Howtoregistertemplates.html">http://help.eclipse.org/helios/index.jsp?topic=/org.eclipse.cdt.doc.isv/guide/projectTemplateEngine/Howtoregistertemplates.html</a>, porém isto não é realmente necessário.</p>
<h3>Configurando o projeto para usar o OpenOCD</h3>
<p>Vá em no menu <strong>Run-&gt;Debug Configurations...</strong></p>
<p>Na lista da esquerda, clique no item <strong>"GDB Hardware Debugging"</strong> e clique no botão <strong>"New launch configuration"</strong>.</p>
<p>Dê um nome à configuração, no campo <strong>"Name"</strong>.</p>
<p>Caso deseje, pode-se desabilitar a construção automática do programa, selecionando a opção <strong>"Disable auto build"</strong>, na aba <strong>"Main"</strong>.</p>
<p>Vá na aba <strong>"Debugger"</strong>, em <strong>"GDB Command"</strong>, coloque <strong><code>arm-none-eabi-gdb</code></strong>.</p>
<p>Certifique-se que a opção <strong>"Use remote target"</strong> está ativada e em <strong>"JTAG Device"</strong>, mantenha <strong>"Generic TCP/IP"</strong>, mas troque o <strong>"Port number"</strong> para <strong>3333</strong>.
Opcionalmente pode-se ativar também a opção <strong>"Force thread list update on suspend"</strong>.</p>
<p><img alt="" src="../../../../../artigos/Microcontroladores/eclipse/debug_01.png" style="max-width:100%;width:1098px;margin-left:auto;margin-right:auto;height:auto"><div class="caption"></div></p>
<p>Vá na aba <strong>"Startup"</strong>, desabilite as opções <strong>"Reset and Delay (seconds)"</strong> e <strong>"Halt"</strong> e na caixa logo abaixo, coloque</p>
<div class="highlight"><pre><span></span>monitor reset halt
monitor flash probe 0
monitor stm32x mass_erase 0
monitor flash write_bank 0 main.bin 0
monitor reset halt
</pre></div>


<p>Desabilite a caixa <strong>"Load image"</strong></p>
<p><em>Opcional:</em> caso deseje parar a execução antes do programa do usuário iniciar (na entrada da função <code>main()</code>), habilite a opção <strong>"Set breakpoint at:"</strong> e digite <strong><code>main</code></strong> na caixa ao lado.</p>
<div class="admonition note">
<p class="admonition-title"><i class="fa fa-warning"></i> Importante!</p>
<p>Para executar o debug desta forma, a placa deve estar com <strong><code>BOOT0=0</code></strong>, ou seja, em modo de execução.
Do contrário a placa entrará no bootloader e o núcleo do microcontrolador entrará nos endereços 0x1fffffff.</p>
<p>Caso realmente deseje operar com <strong><code>BOOT0=1</code></strong> selecionado, é possível, de forma dependente do microcontrolador.
Para isto, selecione a caixa <strong>"Set program counter at (hex)"</strong> e escreva ao lado o endereço do Reset_Handler.
No caso do STM32, o valor é <strong>08000004</strong>.</p>
</div>
<p>Finalmente, na linha logo antes do botão <strong>Apply</strong>, verifique se está selecionado <strong>"Using Standard GDB Hardware Debugging Launhcer"</strong>.
Caso não esteja, selecione <strong>"Select other"</strong>.
Na caixa que aparecer, clique em <strong>"Change workspace settings"</strong> e vá em <strong>GDB Hardware Debugging-&gt;[Debug]</strong>.
Na caixa ao lado (<strong>Preferred Launcher</strong>) marque <strong>"Standard GDB Hardware Debugging Launhcer"</strong>.</p>
<p><img alt="" src="../../../../../artigos/Microcontroladores/eclipse/debug_02.png" style="max-width:100%;width:989px;margin-left:auto;margin-right:auto;height:auto"><div class="caption"></div></p>
<p>Para que esta configuração de debug fique associada ao projeto, vá na aba <strong>"Common"</strong> e selecione a opção <strong>"Shared file"</strong>, selecionando a pasta do projeto ao lado.
Assim, esta configuração de debug só ficará disponível quando o projeto estiver aberto.
Para completar, selecione <strong>"Debug"</strong> na caixa <strong>"Display in favorites menu"</strong>, para a configuração ficar disponível no botão de debug.</p>
<h3>Testando o GDB</h3>
<p>Com o OpenOCD funcionando, é possível testar a funcionalidade do GDB para o carregamento e execução de um programa na placa.
Para isto, vá na linha de comando <code>cmd.exe</code>, vá até a pasta do projeto e execute (por exemplo para um projeto chamado <em>blinky</em>):</p>
<div class="highlight"><pre><span></span>cd Debug
arm-none-eabi-gdb blinky.elf
</pre></div>


<p>Isso abrirá a linha de comando do GDB, indicada por <code>(gdb)</code> no início da linha:</p>
<div class="highlight"><pre><span></span>GNU gdb (Sourcery G++ Lite 2011.03-42) 7.2.50.20100908-cvs
Copyright (C) 2010 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "--host=i686-mingw32 --target=arm-none-eabi".
For bug reporting instructions, please see:
&lt;https://support.codesourcery.com/GNUToolchain/&gt;...
Reading symbols from d:\workspace\chavant-imu\debug\ChaVANT-IMU.elf...done.
(gdb)
</pre></div>


<p>A partir daí, podemos digitar os comandos do GDB.
As linhas que começam com <code>monitor</code> indicam que o comando será enviado para o monitor, que neste caso é o OpenOCD.
Desta forma podemos também executar comandos do OpenOCD diretamente pelo GDB.</p>
<p>Começe então, conectando-se ao OpenOCD (este já deve estar executando):</p>
<div class="highlight"><pre><span></span>target remote localhost:3333
</pre></div>


<p>Reinicie o microcontrolador e coloque-o em estado de <em>halt</em> para que operações como a programação possam ser feitas:</p>
<div class="highlight"><pre><span></span>monitor reset halt
</pre></div>


<p>Carregue o programa com</p>
<div class="highlight"><pre><span></span>monitor flash probe 0
monitor stm32x mass_erase 0
monitor flash write_bank 0 main.bin 0
</pre></div>


<p>E comece a execução do programa com</p>
<div class="highlight"><pre><span></span>monitor reset
</pre></div>


<p>Para pausar o programa:</p>
<div class="highlight"><pre><span></span>monitor halt
</pre></div>


<p>Isso pausará o programa e mostrará em qual instrução o programa está parado na variável pc.
Para ver qual linha isso corresponde no código C++ (junto com as linhas próximas), digite</p>
<div class="highlight"><pre><span></span>l
</pre></div>


<p>E para voltar à execução do programa:</p>
<div class="highlight"><pre><span></span>monitor resume
</pre></div>


<h3>Convertendo um projeto C para C++</h3>
<p>O Eclipse deveria poder converter um projeto para C para C++ e vice-versa indo no menu <strong>File-&gt;New-&gt;Convert to a C/C++ Project (Adds C/C++ Nature)</strong>.
No entanto, isto não funcionou comigo, pois o projeto não apareceu na caixa <strong>Candidates for conversion</strong> na janela que aparece.</p>
<p>Para resolver isto, feche o projeto, vá na sua pasta e edite o arquivo <strong><code>.project</code></strong>.
Procure pelo tag <strong><code>&lt;natures&gt;</code></strong> (perto do final do arquivo) e adicione a seguinte linha:</p>
<div class="highlight"><pre><span></span>    <span class="nt">&lt;nature&gt;</span>org.eclipse.cdt.core.ccnature<span class="nt">&lt;/nature&gt;</span>
</pre></div>


<p>Abra novamente o projeto e ele já será um projeto C++.</p>
<h2>Anexos</h2>
<h3>Programa de teste básico em C (Blinky)</h3>
<p>Caso deseje um <code>main.c</code> mais simples para começar, com um LED piscando a cada aproximadamente 1s, use o código abaixo:</p>
<h5><i class="fa fa-file-code-o"></i> main.c</h5>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> * main.c</span>
<span class="cm"> *</span>
<span class="cm"> *      Author: Ronan Alves da Paixão</span>
<span class="cm"> *      &lt;ronan@dapaixao.com.br&gt;</span>
<span class="cm"> *      http://ronan.dapaixao.com.br</span>
<span class="cm"> */</span>

<span class="cp">#define LED_PORT    GPIOC</span>
<span class="cp">#define LED_PIN     (GPIO_Pin_6 | GPIO_Pin_7)</span>
<span class="cp">#define LED_RCC     RCC_APB2Periph_GPIOC</span>
<span class="cp">#define LED_ClockCmd    RCC_APB2PeriphClockCmd</span>

<span class="kt">void</span> <span class="nf">Delay</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">uint32_t</span> <span class="n">nCount</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">GPIO_InitTypeDef</span>  <span class="n">GPIO_InitStructure</span><span class="p">;</span>
  <span class="n">LED_ClockCmd</span><span class="p">(</span><span class="n">RCC_APB2Periph_GPIOC</span><span class="p">,</span> <span class="n">ENABLE</span><span class="p">);</span>

  <span class="cm">/* Configura o(s) pino(s) GPIO_LED */</span>
  <span class="n">GPIO_InitStructure</span><span class="p">.</span><span class="n">GPIO_Pin</span> <span class="o">=</span> <span class="n">LED_PIN</span><span class="p">;</span>
  <span class="n">GPIO_InitStructure</span><span class="p">.</span><span class="n">GPIO_Mode</span> <span class="o">=</span> <span class="n">GPIO_Mode_Out_PP</span><span class="p">;</span>
  <span class="n">GPIO_InitStructure</span><span class="p">.</span><span class="n">GPIO_Speed</span> <span class="o">=</span> <span class="n">GPIO_Speed_50MHz</span><span class="p">;</span>
  <span class="n">GPIO_Init</span><span class="p">(</span><span class="n">LED_PORT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">GPIO_InitStructure</span><span class="p">);</span>

  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">LED_PORT</span><span class="o">-&gt;</span><span class="n">ODR</span> <span class="o">^=</span> <span class="n">LED_PIN</span><span class="p">;</span>
    <span class="n">Delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">Delay</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">uint32_t</span> <span class="n">nCount</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">nCount</span> <span class="o">=</span> <span class="n">nCount</span><span class="o">*</span><span class="p">(</span><span class="n">SystemCoreClock</span><span class="o">/</span><span class="mi">1000</span><span class="o">/</span><span class="mi">3</span><span class="p">);</span>
    <span class="k">for</span><span class="p">(;</span> <span class="n">nCount</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">nCount</span><span class="o">--</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h3>Projeto C/C++ completo</h3>
<p>Baixe um projeto C/C++ completo no arquivo <a href="../../../../../artigos/Microcontroladores/eclipse/stm32_cpp_template.zip">stm32_cpp_template.zip</a>.</p>
<p>Para importá-lo para o workspace no Eclipse, verifique se já não existe algum projeto chamado <code>STM32_CPP_Template</code>.
Se houver, renomeie-o.</p>
<p>Vá em <strong>File-&gt;Import</strong>.
Na janela que aparecer, selecione <strong>"Existing Projects into Workspace"</strong> e clique em <strong>Next</strong>.</p>
<p>Na janela <em>Import</em>, selecione a opção <strong>"Select archive file"</strong>.
No campo ao lado, coloque o nome do arquivo com caminho completo ou clique em <strong>Browse</strong> e encontre-o.
O projeto será selecionado no campo <strong>"Projects"</strong>.
Clique em <strong>Finish</strong>.</p>
<p>Renomeie o projeto para o nome desejado, por exemplo <code>Blinky</code>.</p>
<p>Vá no menu <strong>Run-&gt;Debug configurations...</strong>.
Selecione a configuração <strong>GDB Hardware Debugging-&gt;STM32 Template Debug</strong>.
No campo <strong>Name</strong>, renomeie a configuração para um nome significativo para o projeto, por exemplo <code>Blinky Debug</code>.
Troque o campo <strong>"C/C++ Application"</strong> para o arquivo ELF gerado, por exemplo <code>Debug/Blinky.elf</code>.
Caso o projeto já tenha sido construído, basta clicar no botão <strong>Search Project</strong> e selecionar o arquivo ELF gerado.
Clique no botão <strong>Apply</strong>.</p>
<p>O novo projeto já estará pronto para ser usado.</p>
<h2>Referências</h2>
<ul>
<li><a href="http://sourceforge.net/apps/mediawiki/gnuarmeclipse/index.php?title=Plug-in_Installation">http://sourceforge.net/apps/mediawiki/gnuarmeclipse/index.php?title=Plug-in_Installation</a></li>
<li><a href="http://www.makingthings.com/wiki/creating-an-eclipse-project">http://www.makingthings.com/wiki/creating-an-eclipse-project</a></li>
<li><a href="http://fun-tech.se/stm32/gcc/compile_blinky.php">http://fun-tech.se/stm32/gcc/compile_blinky.php</a></li>
<li><a href="http://fun-tech.se/stm32/OpenOCD/index.php">http://fun-tech.se/stm32/OpenOCD/index.php</a></li>
<li><a href="https://sites.google.com/site/stm32discovery/open-source-development-with-the-stm32-discovery/getting-hardware-debuging-working-with-eclipse-and-code-sourcey">https://sites.google.com/site/stm32discovery/open-source-development-with-the-stm32-discovery/getting-hardware-debuging-working-with-eclipse-and-code-sourcey</a></li>
<li><a href="http://openocd.berlios.de/doc/html/Flash-Commands.html">http://openocd.berlios.de/doc/html/Flash-Commands.html</a></li>
<li><a href="http://openocd.berlios.de/doc/html/CPU-Configuration.html">http://openocd.berlios.de/doc/html/CPU-Configuration.html</a></li>
<li><a href="https://sites.google.com/site/stm32discovery/open-source-development-with-the-stm32-discovery/setting-up-eclipse-for-stm32-discovery-development">https://sites.google.com/site/stm32discovery/open-source-development-with-the-stm32-discovery/setting-up-eclipse-for-stm32-discovery-development</a></li>
<li><a href="http://electrotormentor.blogspot.com/2011/04/configuring-eclipse-for-stm32.html">http://electrotormentor.blogspot.com/2011/04/configuring-eclipse-for-stm32.html</a></li>
<li><a href="http://betterexplained.com/articles/debugging-with-gdb/">http://betterexplained.com/articles/debugging-with-gdb/</a></li>
<li><a href="http://embeddedfreak.wordpress.com/2009/02/10/removing-unused-functionsdead-codes-with-gccgnu-ld/">http://embeddedfreak.wordpress.com/2009/02/10/removing-unused-functionsdead-codes-with-gccgnu-ld/</a></li>
<li><a href="http://help.eclipse.org/indigo/index.jsp?topic=/org.eclipse.cdt.doc.user/tasks/cdt_t_add_custom_persp.htm">http://help.eclipse.org/indigo/index.jsp?topic=/org.eclipse.cdt.doc.user/tasks/cdt_t_add_custom_persp.htm</a></li>
<li><a href="http://avi.hobby-site.org:8888/wiki/index.php/Microcontrollers_&_the_STM32">http://avi.hobby-site.org:8888/wiki/index.php/Microcontrollers_&_the_STM32</a></li>
<li><a href="http://www.sciencezero.org/index.php?title=ARM:_Cortex-M3_Thumb-2_instruction_set">http://www.sciencezero.org/index.php?title=ARM:_Cortex-M3_Thumb-2_instruction_set</a></li>
</ul>
            </div>
            <!-- /.entry-content -->
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">
            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
              <ul class="list-group" id="social">
                <li class="list-group-item"><a href="https://br.linkedin.com/in/ronanpaixao"><i class="fa fa-linkedin-square fa-lg"></i> linkedin</a></li>
                <li class="list-group-item"><a href="#"><i class="fa fa-segurança-da-informação✓</abbr>-square fa-lg"></i> Segurança da informação✓</abbr></a></li>
              </ul>
            </li>





    <li class="list-group-item"><h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
      <ul class="list-group" id="links">
        <li class="list-group-item">
            <a href="http://python.org/" target="_blank">
                Python.org
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://www.scipy.org/" target="_blank">
                SciPy
            </a>
        </li>
        <li class="list-group-item">
            <a href="https://pythonhosted.org/spyder/" target="_blank">
                Spyder IDE
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://getpelican.com/" target="_blank">
                Pelican
            </a>
        </li>
      </ul>
    </li>
    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2016 Ronan Paixão
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="../../../../../theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="../../../../../theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="../../../../../theme/js/respond.min.js"></script>


</body>
</html>